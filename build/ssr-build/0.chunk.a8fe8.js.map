{"version":3,"sources":["webpack:///../node_modules/@firebase/installations/node_modules/idb/lib/idb.mjs","webpack:///../node_modules/@firebase/installations/dist/index.esm.js","webpack:///../node_modules/@firebase/performance/dist/index.esm.js","webpack:///../node_modules/firebase/performance/dist/index.esm.js"],"names":["version","PENDING_TIMEOUT_MS","PACKAGE_VERSION","INTERNAL_AUTH_VERSION","INSTALLATIONS_API_URL","TOKEN_EXPIRATION_BUFFER","SERVICE","SERVICE_NAME","_a","ERROR_DESCRIPTION_MAP","ERROR_FACTORY","ErrorFactory","isServerError","error","FirebaseError","code","includes","extractAppConfig","app","options","create","appName","name","projectId","apiKey","appId","getInstallationsEndpoint","extractAuthTokenInfoFromResponse","response","token","requestStatus","expiresIn","getExpiresInFromResponseExpiresIn","creationTime","Date","now","getErrorFromResponse","requestName","__awaiter","responseJson","errorData","__generator","label","json","sent","serverCode","serverMessage","message","serverStatus","status","getHeaders","Headers","Accept","getHeadersWithAuth","appConfig","refreshToken","headers","append","getAuthorizationHeader","retryIfServerError","fn","result","responseExpiresIn","Number","replace","createInstallation","fid","endpoint","body","request","responseValue","registeredInstallationEntry","_b","authVersion","sdkVersion","method","JSON","stringify","fetch","ok","registrationStatus","authToken","sleep","ms","Promise","resolve","setTimeout","bufferToBase64UrlSafe","array","b64","btoa","String","fromCharCode","apply","__spread","VALID_FID_PATTERN","INVALID_FID","generateFid","fidByteArray","Uint8Array","crypto_1","self","crypto","msCrypto","getRandomValues","encode","test","b64String","substr","DATABASE_NAME","DATABASE_VERSION","OBJECT_STORE_NAME","dbPromise","getDbPromise","openDb","upgradeDB","oldVersion","createObjectStore","set","value","key","db","tx","getKey","transaction","objectStore","put","complete","remove","delete","update","updateFn","store","oldValue","newValue","get","undefined","getInstallationEntry","registrationPromise","installationEntry","oldEntry","updateOrCreateInstallationEntry","entryWithPromise","triggerRegistrationIfNecessary","entry","hasInstallationRequestTimedOut","navigator","onLine","registrationPromiseWithError","reject","inProgressEntry","registrationTime","registerInstallation","waitUntilFidRegistration","e_1","trys","push","updateInstallationRequest","generateAuthToken","completedAuthToken","getGenerateAuthTokenEndpoint","installation","refreshAuthToken","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenValid","waitUntilAuthTokenRequest","makeAuthTokenRequestInProgressEntry","fetchAuthTokenFromServer","updateAuthTokenRequest","hasAuthTokenRequestTimedOut","__assign","updatedInstallationEntry","isAuthTokenExpired","inProgressAuthToken","requestTime","getId","catch","getToken","completeInstallationRegistration","deleteInstallation","getDeleteEndpoint","deleteInstallation$1","registerInstallations","instance","installationsName","factoryMethod","INTERNAL","registerService","firebase","SDK_VERSION","TRACE_START_MARK_PREFIX","TRACE_STOP_MARK_PREFIX","TRACE_MEASURE_PREFIX","OOB_TRACE_PAGE_LOAD_PREFIX","FIRST_PAINT_COUNTER_NAME","FIRST_CONTENTFUL_PAINT_COUNTER_NAME","FIRST_INPUT_DELAY_COUNTER_NAME","CONFIG_LOCAL_STORAGE_KEY","CONFIG_EXPIRY_LOCAL_STORAGE_KEY","apiInstance","windowInstance","Api","window","performance","PerformanceObserver","windowLocation","location","document","cookieEnabled","localStorage","perfMetrics","onFirstInputDelay","prototype","getUrl","href","split","mark","measure","measureName","mark1","mark2","getEntriesByType","type","getEntriesByName","getTimeOrigin","timeOrigin","timing","navigationStart","requiredApisAvailable","setupObserver","entryType","callback","observer","list","_i","getEntries","length","observe","entryTypes","getInstance","setupApi","settingsServiceInstance","SettingsService","instrumentationEnabled","dataCollectionEnabled","loggingEnabled","tracesSamplingRate","networkRequestsSamplingRate","logEndPointUrl","logSource","logTraceAfterSampling","logNetworkAfterSampling","configTimeToLive","getAppId","firebaseAppInstance","getProjectId","getApiKey","iid","getIidPromise","iidPromise","installations","then","iidVal","getIid","getAuthTokenPromise","authTokenPromise","authTokenVal","VisibilityState","RESERVED_ATTRIBUTE_PREFIXES","ATTRIBUTE_FORMAT_REGEX","RegExp","MAX_ATTRIBUTE_NAME_LENGTH","MAX_ATTRIBUTE_VALUE_LENGTH","getServiceWorkerStatus","serviceWorker","controller","getVisibilityState","visibilityState","VISIBLE","HIDDEN","PRERENDER","UNKNOWN","getEffectiveConnectionType","navigatorConnection","connection","effectiveType","isValidCustomAttributeName","matchesReservedPrefix","some","prefix","startsWith","match","isValidCustomAttributeValue","consoleLogger","Logger","logLevel","LogLevel","INFO","REMOTE_CONFIG_SDK_VERSION","SECONDARY_CONFIGS","FIS_AUTH_PREFIX","getConfig","config","getStoredConfig","processConfig","getRemoteConfig","storeConfig","expiryString","getItem","configValid","configStringified","configResponse","parse","setItem","COULD_NOT_GET_CONFIG_MSG","configEndPoint","Request","Authorization","app_instance_id","app_instance_id_token","app_id","app_version","sdk_version","info","entries","fpr_enabled","fpr_log_source","fpr_log_endpoint_url","fpr_vc_network_request_sampling_rate","fpr_vc_trace_sampling_rate","shouldLogAfterSampling","expiry","samplingRate","Math","random","initializationStatus","initializationPromise","getInitializationPromise","initializePerf","isPerfInitialized","getDocumentReadyComplete","changeInitializationStatus","readyState","handler_1","removeEventListener","addEventListener","DEFAULT_SEND_INTERVAL_MS","INITIAL_SEND_TIME_DELAY_MS","DEFAULT_REMAINING_TRIES","remainingTries","queue","processQueue","timeOffset","staged","slice","log_event","map","evt","source_extension_json","event_time_ms","eventTime","data","request_time_ms","client_info","client_type","js_client_info","log_source","res","wait","next_request_wait_millis","requestOffset","isNaN","max","concat","addToQueue","ccHandler","serializer","_loggerInstance","_level","args","arguments","logger","getLogger","ccLogger","logHandler","logTrace","trace","settingsService","isAuto","sendTraceLog","log","logNetworkRequest","networkRequest","url","resource","resourceType","serializeNetworkRequest","serializeTrace","networkRequestMetric","http_method","httpMethod","http_response_code","response_payload_bytes","responsePayloadBytes","client_start_time_us","startTimeUs","time_to_response_initiated_us","timeToResponseInitiatedUs","time_to_response_completed_us","timeToResponseCompletedUs","perfMetric","application_info","getApplicationInfo","network_request_metric","traceMetric","is_auto","duration_us","durationUs","Object","keys","counters","convertToKeyValueArray","customAttributes","getAttributes","custom_attributes","trace_metric","google_app_id","web_app_info","page_url","service_worker_status","visibility_state","effective_connection_type","application_process_state","obj","MAX_METRIC_NAME_LENGTH","RESERVED_AUTO_PREFIX","oobMetrics","isValidMetricName","traceName","indexOf","Trace","traceMeasureName","state","api","randomId","floor","traceStartMark","traceStopMark","traceMeasure","calculateTraceMetrics","start","stop","record","startTime","duration","attributes","metrics","metric","incrementMetric","counter","num","putMetric","customMetricName","getMetric","putAttribute","attr","isValidName","isValidValue","attributeName","attributeValue","getAttribute","removeAttribute","setStartTime","setDuration","perfMeasureEntries","perfMeasureEntry","createOobTrace","navigationTimings","paintTimings","firstInputDelay","route","timeOriginUs","domInteractive","domContentLoadedEventEnd","loadEventEnd","FIRST_PAINT","FIRST_CONTENTFUL_PAINT","firstPaint","find","paintObject","firstContentfulPaint","createUserTimingTrace","createNetworkRequestEntry","performanceEntry","responseStart","responseEnd","transferSize","FID_WAIT_TIME_MS","setupOobResources","setupOobTraces","setupNetworkRequests","setupUserTimingTraces","resources","resources_1","timeoutId_1","clearTimeout","measures","measures_1","substring","PerformanceController","defineProperty","val","enumerable","configurable","DEFAULT_ENTRY_NAME","registerPerformance","namespaceExports"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAC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","file":"0.chunk.a8fe8.js","sourcesContent":["function toArray(arr) {\n  return Array.prototype.slice.call(arr);\n}\n\nfunction promisifyRequest(request) {\n  return new Promise(function(resolve, reject) {\n    request.onsuccess = function() {\n      resolve(request.result);\n    };\n\n    request.onerror = function() {\n      reject(request.error);\n    };\n  });\n}\n\nfunction promisifyRequestCall(obj, method, args) {\n  var request;\n  var p = new Promise(function(resolve, reject) {\n    request = obj[method].apply(obj, args);\n    promisifyRequest(request).then(resolve, reject);\n  });\n\n  p.request = request;\n  return p;\n}\n\nfunction promisifyCursorRequestCall(obj, method, args) {\n  var p = promisifyRequestCall(obj, method, args);\n  return p.then(function(value) {\n    if (!value) return;\n    return new Cursor(value, p.request);\n  });\n}\n\nfunction proxyProperties(ProxyClass, targetProp, properties) {\n  properties.forEach(function(prop) {\n    Object.defineProperty(ProxyClass.prototype, prop, {\n      get: function() {\n        return this[targetProp][prop];\n      },\n      set: function(val) {\n        this[targetProp][prop] = val;\n      }\n    });\n  });\n}\n\nfunction proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n  properties.forEach(function(prop) {\n    if (!(prop in Constructor.prototype)) return;\n    ProxyClass.prototype[prop] = function() {\n      return promisifyRequestCall(this[targetProp], prop, arguments);\n    };\n  });\n}\n\nfunction proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n  properties.forEach(function(prop) {\n    if (!(prop in Constructor.prototype)) return;\n    ProxyClass.prototype[prop] = function() {\n      return this[targetProp][prop].apply(this[targetProp], arguments);\n    };\n  });\n}\n\nfunction proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n  properties.forEach(function(prop) {\n    if (!(prop in Constructor.prototype)) return;\n    ProxyClass.prototype[prop] = function() {\n      return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n    };\n  });\n}\n\nfunction Index(index) {\n  this._index = index;\n}\n\nproxyProperties(Index, '_index', [\n  'name',\n  'keyPath',\n  'multiEntry',\n  'unique'\n]);\n\nproxyRequestMethods(Index, '_index', IDBIndex, [\n  'get',\n  'getKey',\n  'getAll',\n  'getAllKeys',\n  'count'\n]);\n\nproxyCursorRequestMethods(Index, '_index', IDBIndex, [\n  'openCursor',\n  'openKeyCursor'\n]);\n\nfunction Cursor(cursor, request) {\n  this._cursor = cursor;\n  this._request = request;\n}\n\nproxyProperties(Cursor, '_cursor', [\n  'direction',\n  'key',\n  'primaryKey',\n  'value'\n]);\n\nproxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n  'update',\n  'delete'\n]);\n\n// proxy 'next' methods\n['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n  if (!(methodName in IDBCursor.prototype)) return;\n  Cursor.prototype[methodName] = function() {\n    var cursor = this;\n    var args = arguments;\n    return Promise.resolve().then(function() {\n      cursor._cursor[methodName].apply(cursor._cursor, args);\n      return promisifyRequest(cursor._request).then(function(value) {\n        if (!value) return;\n        return new Cursor(value, cursor._request);\n      });\n    });\n  };\n});\n\nfunction ObjectStore(store) {\n  this._store = store;\n}\n\nObjectStore.prototype.createIndex = function() {\n  return new Index(this._store.createIndex.apply(this._store, arguments));\n};\n\nObjectStore.prototype.index = function() {\n  return new Index(this._store.index.apply(this._store, arguments));\n};\n\nproxyProperties(ObjectStore, '_store', [\n  'name',\n  'keyPath',\n  'indexNames',\n  'autoIncrement'\n]);\n\nproxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n  'put',\n  'add',\n  'delete',\n  'clear',\n  'get',\n  'getAll',\n  'getKey',\n  'getAllKeys',\n  'count'\n]);\n\nproxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n  'openCursor',\n  'openKeyCursor'\n]);\n\nproxyMethods(ObjectStore, '_store', IDBObjectStore, [\n  'deleteIndex'\n]);\n\nfunction Transaction(idbTransaction) {\n  this._tx = idbTransaction;\n  this.complete = new Promise(function(resolve, reject) {\n    idbTransaction.oncomplete = function() {\n      resolve();\n    };\n    idbTransaction.onerror = function() {\n      reject(idbTransaction.error);\n    };\n    idbTransaction.onabort = function() {\n      reject(idbTransaction.error);\n    };\n  });\n}\n\nTransaction.prototype.objectStore = function() {\n  return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n};\n\nproxyProperties(Transaction, '_tx', [\n  'objectStoreNames',\n  'mode'\n]);\n\nproxyMethods(Transaction, '_tx', IDBTransaction, [\n  'abort'\n]);\n\nfunction UpgradeDB(db, oldVersion, transaction) {\n  this._db = db;\n  this.oldVersion = oldVersion;\n  this.transaction = new Transaction(transaction);\n}\n\nUpgradeDB.prototype.createObjectStore = function() {\n  return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n};\n\nproxyProperties(UpgradeDB, '_db', [\n  'name',\n  'version',\n  'objectStoreNames'\n]);\n\nproxyMethods(UpgradeDB, '_db', IDBDatabase, [\n  'deleteObjectStore',\n  'close'\n]);\n\nfunction DB(db) {\n  this._db = db;\n}\n\nDB.prototype.transaction = function() {\n  return new Transaction(this._db.transaction.apply(this._db, arguments));\n};\n\nproxyProperties(DB, '_db', [\n  'name',\n  'version',\n  'objectStoreNames'\n]);\n\nproxyMethods(DB, '_db', IDBDatabase, [\n  'close'\n]);\n\n// Add cursor iterators\n// TODO: remove this once browsers do the right thing with promises\n['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n  [ObjectStore, Index].forEach(function(Constructor) {\n    // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n    if (!(funcName in Constructor.prototype)) return;\n\n    Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n      var args = toArray(arguments);\n      var callback = args[args.length - 1];\n      var nativeObject = this._store || this._index;\n      var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n      request.onsuccess = function() {\n        callback(request.result);\n      };\n    };\n  });\n});\n\n// polyfill getAll\n[Index, ObjectStore].forEach(function(Constructor) {\n  if (Constructor.prototype.getAll) return;\n  Constructor.prototype.getAll = function(query, count) {\n    var instance = this;\n    var items = [];\n\n    return new Promise(function(resolve) {\n      instance.iterateCursor(query, function(cursor) {\n        if (!cursor) {\n          resolve(items);\n          return;\n        }\n        items.push(cursor.value);\n\n        if (count !== undefined && items.length == count) {\n          resolve(items);\n          return;\n        }\n        cursor.continue();\n      });\n    });\n  };\n});\n\nexport function openDb(name, version, upgradeCallback) {\n  var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n  var request = p.request;\n\n  if (request) {\n    request.onupgradeneeded = function(event) {\n      if (upgradeCallback) {\n        upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n      }\n    };\n  }\n\n  return p.then(function(db) {\n    return new DB(db);\n  });\n}\n\nexport function deleteDb(name) {\n  return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/@firebase/installations/node_modules/idb/lib/idb.mjs\n// module id = null\n// module chunks = ","import firebase from '@firebase/app';\nimport { __awaiter, __generator, __spread, __assign } from 'tslib';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDb } from 'idb';\n\nvar version = \"0.2.7\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar PENDING_TIMEOUT_MS = 10000;\r\nvar PACKAGE_VERSION = \"w:\" + version;\r\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\r\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\r\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\r\nvar SERVICE = 'installations';\r\nvar SERVICE_NAME = 'Installations';\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_DESCRIPTION_MAP = (_a = {},\r\n    _a[\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration values.',\r\n    _a[\"create-installation-failed\" /* CREATE_INSTALLATION_FAILED */] = 'Could not register Firebase Installation.',\r\n    _a[\"generate-token-failed\" /* GENERATE_TOKEN_FAILED */] = 'Could not generate Auth Token.',\r\n    _a[\"not-registered\" /* NOT_REGISTERED */] = 'Firebase Installation is not registered.',\r\n    _a[\"installation-not-found\" /* INSTALLATION_NOT_FOUND */] = 'Firebase Installation not found.',\r\n    _a[\"request-failed\" /* REQUEST_FAILED */] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',\r\n    _a[\"app-offline\" /* APP_OFFLINE */] = 'Could not process request. Application offline.',\r\n    _a[\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */] = \"Can't delete installation while there is a pending registration request.\",\r\n    _a);\r\nvar ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\r\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\r\nfunction isServerError(error) {\r\n    return (error instanceof FirebaseError &&\r\n        error.code.includes(\"request-failed\" /* REQUEST_FAILED */));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    if (!app || !app.options) {\r\n        throw ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */);\r\n    }\r\n    var appName = app.name;\r\n    var _a = app.options, projectId = _a.projectId, apiKey = _a.apiKey, appId = _a.appId;\r\n    if (!appName || !projectId || !apiKey || !appId) {\r\n        throw ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */);\r\n    }\r\n    return { appName: appName, projectId: projectId, apiKey: apiKey, appId: appId };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getInstallationsEndpoint(_a) {\r\n    var projectId = _a.projectId;\r\n    return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\r\n}\r\nfunction extractAuthTokenInfoFromResponse(response) {\r\n    return {\r\n        token: response.token,\r\n        requestStatus: 2 /* COMPLETED */,\r\n        expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\r\n        creationTime: Date.now()\r\n    };\r\n}\r\nfunction getErrorFromResponse(requestName, response) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var responseJson, errorData;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, response.json()];\r\n                case 1:\r\n                    responseJson = _a.sent();\r\n                    errorData = responseJson.error;\r\n                    return [2 /*return*/, ERROR_FACTORY.create(\"request-failed\" /* REQUEST_FAILED */, {\r\n                            requestName: requestName,\r\n                            serverCode: errorData.code,\r\n                            serverMessage: errorData.message,\r\n                            serverStatus: errorData.status\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getHeaders(_a) {\r\n    var apiKey = _a.apiKey;\r\n    return new Headers({\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        'x-goog-api-key': apiKey\r\n    });\r\n}\r\nfunction getHeadersWithAuth(appConfig, _a) {\r\n    var refreshToken = _a.refreshToken;\r\n    var headers = getHeaders(appConfig);\r\n    headers.append('Authorization', getAuthorizationHeader(refreshToken));\r\n    return headers;\r\n}\r\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\r\nfunction retryIfServerError(fn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var result;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, fn()];\r\n                case 1:\r\n                    result = _a.sent();\r\n                    if (result.status >= 500 && result.status < 600) {\r\n                        // Internal Server Error. Retry request.\r\n                        return [2 /*return*/, fn()];\r\n                    }\r\n                    return [2 /*return*/, result];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\r\n    // This works because the server will never respond with fractions of a second.\r\n    return Number(responseExpiresIn.replace('s', '000'));\r\n}\r\nfunction getAuthorizationHeader(refreshToken) {\r\n    return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction createInstallation(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getInstallationsEndpoint(appConfig);\r\n                    headers = getHeaders(appConfig);\r\n                    body = {\r\n                        fid: fid,\r\n                        authVersion: INTERNAL_AUTH_VERSION,\r\n                        appId: appConfig.appId,\r\n                        sdkVersion: PACKAGE_VERSION\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    registeredInstallationEntry = {\r\n                        fid: responseValue.fid || fid,\r\n                        registrationStatus: 2 /* COMPLETED */,\r\n                        refreshToken: responseValue.refreshToken,\r\n                        authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\r\n                    };\r\n                    return [2 /*return*/, registeredInstallationEntry];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Create Installation', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a promise that resolves after given time passes. */\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction bufferToBase64UrlSafe(array) {\r\n    var b64 = btoa(String.fromCharCode.apply(String, __spread(array)));\r\n    return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\r\nvar INVALID_FID = '';\r\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\r\nfunction generateFid() {\r\n    try {\r\n        // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\r\n        // bytes. our implementation generates a 17 byte array instead.\r\n        var fidByteArray = new Uint8Array(17);\r\n        var crypto_1 = self.crypto || self.msCrypto;\r\n        crypto_1.getRandomValues(fidByteArray);\r\n        // Replace the first 4 random bits with the constant FID header of 0b0111.\r\n        fidByteArray[0] = 112 + (fidByteArray[0] % 16);\r\n        var fid = encode(fidByteArray);\r\n        return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\r\n    }\r\n    catch (_a) {\r\n        // FID generation errored\r\n        return INVALID_FID;\r\n    }\r\n}\r\n/** Converts a FID Uint8Array to a base64 string representation. */\r\nfunction encode(fidByteArray) {\r\n    var b64String = bufferToBase64UrlSafe(fidByteArray);\r\n    // Remove the 23rd character that was added because of the extra 4 bits at the\r\n    // end of our 17 byte array, and the '=' padding.\r\n    return b64String.substr(0, 22);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DATABASE_NAME = 'firebase-installations-database';\r\nvar DATABASE_VERSION = 1;\r\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\r\nvar dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\r\n            // We don't use 'break' in this switch statement, the fall-through\r\n            // behavior is what we want, because if there are multiple versions between\r\n            // the old version and the current version, we want ALL the migrations\r\n            // that correspond to those versions to run, not only the last one.\r\n            // eslint-disable-next-line default-case\r\n            switch (upgradeDB.oldVersion) {\r\n                case 0:\r\n                    upgradeDB.createObjectStore(OBJECT_STORE_NAME);\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nfunction set(appConfig, value) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).put(value, key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/, value];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nfunction remove(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\r\nfunction update(appConfig, updateFn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx, store, oldValue, newValue;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    store = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, store.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    newValue = updateFn(oldValue);\r\n                    if (newValue === oldValue) {\r\n                        return [2 /*return*/, newValue];\r\n                    }\r\n                    if (!(newValue === undefined)) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, store.delete(key)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: return [4 /*yield*/, store.put(newValue, key)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [4 /*yield*/, tx.complete];\r\n                case 7:\r\n                    _a.sent();\r\n                    return [2 /*return*/, newValue];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getKey(appConfig) {\r\n    return appConfig.appName + \"!\" + appConfig.appId;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\r\nfunction getInstallationEntry(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise, installationEntry, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                        var installationEntry = updateOrCreateInstallationEntry(oldEntry);\r\n                        var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\r\n                        registrationPromise = entryWithPromise.registrationPromise;\r\n                        return entryWithPromise.installationEntry;\r\n                    })];\r\n                case 1:\r\n                    installationEntry = _b.sent();\r\n                    if (!(installationEntry.fid === INVALID_FID)) return [3 /*break*/, 3];\r\n                    _a = {};\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2: \r\n                // FID generation failed. Waiting for the FID from the server.\r\n                return [2 /*return*/, (_a.installationEntry = _b.sent(), _a)];\r\n                case 3: return [2 /*return*/, {\r\n                        installationEntry: installationEntry,\r\n                        registrationPromise: registrationPromise\r\n                    }];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction updateOrCreateInstallationEntry(oldEntry) {\r\n    var entry = oldEntry || {\r\n        fid: generateFid(),\r\n        registrationStatus: 0 /* NOT_STARTED */\r\n    };\r\n    if (hasInstallationRequestTimedOut(entry)) {\r\n        return {\r\n            fid: entry.fid,\r\n            registrationStatus: 0 /* NOT_STARTED */\r\n        };\r\n    }\r\n    return entry;\r\n}\r\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the registration\r\n * and return an InProgressInstallationEntry.\r\n */\r\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\r\n    if (installationEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n        if (!navigator.onLine) {\r\n            // Registration required but app is offline.\r\n            var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */));\r\n            return {\r\n                installationEntry: installationEntry,\r\n                registrationPromise: registrationPromiseWithError\r\n            };\r\n        }\r\n        // Try registering. Change status to IN_PROGRESS.\r\n        var inProgressEntry = {\r\n            fid: installationEntry.fid,\r\n            registrationStatus: 1 /* IN_PROGRESS */,\r\n            registrationTime: Date.now()\r\n        };\r\n        var registrationPromise = registerInstallation(appConfig, inProgressEntry);\r\n        return { installationEntry: inProgressEntry, registrationPromise: registrationPromise };\r\n    }\r\n    else if (installationEntry.registrationStatus === 1 /* IN_PROGRESS */) {\r\n        return {\r\n            installationEntry: installationEntry,\r\n            registrationPromise: waitUntilFidRegistration(appConfig)\r\n        };\r\n    }\r\n    else {\r\n        return { installationEntry: installationEntry };\r\n    }\r\n}\r\n/** This will be executed only once for each new Firebase Installation. */\r\nfunction registerInstallation(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registeredInstallationEntry, e_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 2, , 7]);\r\n                    return [4 /*yield*/, createInstallation(appConfig, installationEntry)];\r\n                case 1:\r\n                    registeredInstallationEntry = _a.sent();\r\n                    return [2 /*return*/, set(appConfig, registeredInstallationEntry)];\r\n                case 2:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && e_1.serverCode === 409)) return [3 /*break*/, 4];\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 3:\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: \r\n                // Registration failed. Set FID as not registered.\r\n                return [4 /*yield*/, set(appConfig, {\r\n                        fid: installationEntry.fid,\r\n                        registrationStatus: 0 /* NOT_STARTED */\r\n                    })];\r\n                case 5:\r\n                    // Registration failed. Set FID as not registered.\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: throw e_1;\r\n                case 7: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Call if FID registration is pending. */\r\nfunction waitUntilFidRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    _a.label = 2;\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // createInstallation request still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // createInstallation request still in progress.\r\n                    _a.sent();\r\n                    return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 4:\r\n                    entry = _a.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    if (entry.registrationStatus === 0 /* NOT_STARTED */) {\r\n                        throw ERROR_FACTORY.create(\"create-installation-failed\" /* CREATE_INSTALLATION_FAILED */);\r\n                    }\r\n                    return [2 /*return*/, entry];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateInstallationRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!oldEntry) {\r\n            throw ERROR_FACTORY.create(\"installation-not-found\" /* INSTALLATION_NOT_FOUND */);\r\n        }\r\n        if (hasInstallationRequestTimedOut(oldEntry)) {\r\n            return {\r\n                fid: oldEntry.fid,\r\n                registrationStatus: 0 /* NOT_STARTED */\r\n            };\r\n        }\r\n        return oldEntry;\r\n    });\r\n}\r\nfunction hasInstallationRequestTimedOut(installationEntry) {\r\n    return (installationEntry.registrationStatus === 1 /* IN_PROGRESS */ &&\r\n        installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction generateAuthToken(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, body, request, response, responseValue, completedAuthToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    body = {\r\n                        installation: {\r\n                            sdkVersion: PACKAGE_VERSION\r\n                        }\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _a.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _a.sent();\r\n                    completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\r\n                    return [2 /*return*/, completedAuthToken];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Generate Auth Token', response)];\r\n                case 4: throw _a.sent();\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\r\nfunction refreshAuthToken(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tokenPromise, entry, authToken, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                        if (!isEntryRegistered(oldEntry)) {\r\n                            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n                        }\r\n                        var oldAuthToken = oldEntry.authToken;\r\n                        if (isAuthTokenValid(oldAuthToken)) {\r\n                            // There is a valid token in the DB.\r\n                            return oldEntry;\r\n                        }\r\n                        else if (oldAuthToken.requestStatus === 1 /* IN_PROGRESS */) {\r\n                            // There already is a token request in progress.\r\n                            tokenPromise = waitUntilAuthTokenRequest(appConfig);\r\n                            return oldEntry;\r\n                        }\r\n                        else {\r\n                            // No token or token expired.\r\n                            if (!navigator.onLine) {\r\n                                throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                            }\r\n                            var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\r\n                            tokenPromise = fetchAuthTokenFromServer(appConfig, inProgressEntry);\r\n                            return inProgressEntry;\r\n                        }\r\n                    })];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    if (!tokenPromise) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, tokenPromise];\r\n                case 2:\r\n                    _a = _b.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 3:\r\n                    _a = entry.authToken;\r\n                    _b.label = 4;\r\n                case 4:\r\n                    authToken = _a;\r\n                    return [2 /*return*/, authToken.token];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n */\r\nfunction waitUntilAuthTokenRequest(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry, authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, updateAuthTokenRequest(appConfig)];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    _a.label = 2;\r\n                case 2:\r\n                    if (!(entry.authToken.requestStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // generateAuthToken still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // generateAuthToken still in progress.\r\n                    _a.sent();\r\n                    return [4 /*yield*/, updateAuthTokenRequest(appConfig)];\r\n                case 4:\r\n                    entry = _a.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    authToken = entry.authToken;\r\n                    if (authToken.requestStatus === 0 /* NOT_STARTED */) {\r\n                        throw ERROR_FACTORY.create(\"generate-token-failed\" /* GENERATE_TOKEN_FAILED */);\r\n                    }\r\n                    else {\r\n                        return [2 /*return*/, authToken];\r\n                    }\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateAuthTokenRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!isEntryRegistered(oldEntry)) {\r\n            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n        }\r\n        var oldAuthToken = oldEntry.authToken;\r\n        if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\r\n            return __assign({}, oldEntry, { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n        }\r\n        return oldEntry;\r\n    });\r\n}\r\nfunction fetchAuthTokenFromServer(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 3, , 8]);\r\n                    return [4 /*yield*/, generateAuthToken(appConfig, installationEntry)];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    updatedInstallationEntry = __assign({}, installationEntry, { authToken: authToken });\r\n                    return [4 /*yield*/, set(appConfig, updatedInstallationEntry)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, authToken];\r\n                case 3:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && (e_1.serverCode === 401 || e_1.serverCode === 404))) return [3 /*break*/, 5];\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 4:\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 5:\r\n                    updatedInstallationEntry = __assign({}, installationEntry, { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n                    return [4 /*yield*/, set(appConfig, updatedInstallationEntry)];\r\n                case 6:\r\n                    _a.sent();\r\n                    _a.label = 7;\r\n                case 7: throw e_1;\r\n                case 8: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction isEntryRegistered(installationEntry) {\r\n    return (installationEntry !== undefined &&\r\n        installationEntry.registrationStatus === 2 /* COMPLETED */);\r\n}\r\nfunction isAuthTokenValid(authToken) {\r\n    return (authToken.requestStatus === 2 /* COMPLETED */ &&\r\n        !isAuthTokenExpired(authToken));\r\n}\r\nfunction isAuthTokenExpired(authToken) {\r\n    var now = Date.now();\r\n    return (now < authToken.creationTime ||\r\n        authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER);\r\n}\r\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\r\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\r\n    var inProgressAuthToken = {\r\n        requestStatus: 1 /* IN_PROGRESS */,\r\n        requestTime: Date.now()\r\n    };\r\n    return __assign({}, oldEntry, { authToken: inProgressAuthToken });\r\n}\r\nfunction hasAuthTokenRequestTimedOut(authToken) {\r\n    return (authToken.requestStatus === 1 /* IN_PROGRESS */ &&\r\n        authToken.requestTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getId(app) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appConfig, _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    appConfig = extractAppConfig(app);\r\n                    return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 1:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        // Suppress registration errors as they are not a problem for getId.\r\n                        registrationPromise.catch(function () { });\r\n                    }\r\n                    if (installationEntry.registrationStatus === 2 /* COMPLETED */) {\r\n                        // If the installation is already registered, update the authentication\r\n                        // token if needed. Suppress errors as they are not relevant to getId.\r\n                        refreshAuthToken(appConfig).catch(function () { });\r\n                    }\r\n                    return [2 /*return*/, installationEntry.fid];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getToken(app) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appConfig;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    appConfig = extractAppConfig(app);\r\n                    return [4 /*yield*/, completeInstallationRegistration(appConfig)];\r\n                case 1:\r\n                    _a.sent();\r\n                    // At this point we either have a Registered Installation in the DB, or we've\r\n                    // already thrown an error.\r\n                    return [2 /*return*/, refreshAuthToken(appConfig)];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction completeInstallationRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 1:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (!registrationPromise) return [3 /*break*/, 3];\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2:\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    _b.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 3:\r\n                    if (installationEntry.registrationStatus !== 2 /* COMPLETED */) {\r\n                        // Installation ID can't be registered.\r\n                        throw ERROR_FACTORY.create(\"create-installation-failed\" /* CREATE_INSTALLATION_FAILED */);\r\n                    }\r\n                    _b.label = 4;\r\n                case 4: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallation(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, request, response;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    endpoint = getDeleteEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    request = {\r\n                        method: 'DELETE',\r\n                        headers: headers\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _a.sent();\r\n                    if (!!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, getErrorFromResponse('Delete Installation', response)];\r\n                case 2: throw _a.sent();\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getDeleteEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallation$1(app) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appConfig, entry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    appConfig = extractAppConfig(app);\r\n                    return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                            if (oldEntry && oldEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n                                // Delete the unregistered entry without sending a deleteInstallation request.\r\n                                return undefined;\r\n                            }\r\n                            return oldEntry;\r\n                        })];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    if (!entry) return [3 /*break*/, 6];\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 2];\r\n                    // Can't delete while trying to register.\r\n                    throw ERROR_FACTORY.create(\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */);\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 2 /* COMPLETED */)) return [3 /*break*/, 6];\r\n                    if (!!navigator.onLine) return [3 /*break*/, 3];\r\n                    throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                case 3: return [4 /*yield*/, deleteInstallation(appConfig, entry)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerInstallations(instance) {\r\n    var installationsName = 'installations';\r\n    var factoryMethod = function (app) {\r\n        // Throws if app isn't configured properly.\r\n        extractAppConfig(app);\r\n        return {\r\n            app: app,\r\n            getId: function () { return getId(app); },\r\n            getToken: function () { return getToken(app); },\r\n            delete: function () { return deleteInstallation$1(app); }\r\n        };\r\n    };\r\n    instance.INTERNAL.registerService(installationsName, factoryMethod);\r\n}\r\nregisterInstallations(firebase);\n\nexport { registerInstallations };\n//# sourceMappingURL=index.esm.js.map\n\n\n\n// WEBPACK FOOTER //\n// ../node_modules/@firebase/installations/dist/index.esm.js","import firebase from '@firebase/app';\nimport { __assign } from 'tslib';\nimport { ErrorFactory } from '@firebase/util';\nimport '@firebase/installations';\nimport { Logger, LogLevel } from '@firebase/logger';\n\nvar version = \"0.2.19\";\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar SDK_VERSION = version;\r\n/** The prefix for start User Timing marks used for creating Traces. */\r\nvar TRACE_START_MARK_PREFIX = 'FB-PERF-TRACE-START';\r\n/** The prefix for stop User Timing marks used for creating Traces. */\r\nvar TRACE_STOP_MARK_PREFIX = 'FB-PERF-TRACE-STOP';\r\n/** The prefix for User Timing measure used for creating Traces. */\r\nvar TRACE_MEASURE_PREFIX = 'FB-PERF-TRACE-MEASURE';\r\n/** The prefix for out of the box page load Trace name. */\r\nvar OOB_TRACE_PAGE_LOAD_PREFIX = '_wt_';\r\nvar FIRST_PAINT_COUNTER_NAME = '_fp';\r\nvar FIRST_CONTENTFUL_PAINT_COUNTER_NAME = '_fcp';\r\nvar FIRST_INPUT_DELAY_COUNTER_NAME = '_fid';\r\nvar CONFIG_LOCAL_STORAGE_KEY = '@firebase/performance/config';\r\nvar CONFIG_EXPIRY_LOCAL_STORAGE_KEY = '@firebase/performance/configexpire';\r\nvar SERVICE = 'performance';\r\nvar SERVICE_NAME = 'Performance';\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_DESCRIPTION_MAP = (_a = {},\r\n    _a[\"trace started\" /* TRACE_STARTED_BEFORE */] = 'Trace {$traceName} was started before.',\r\n    _a[\"trace stopped\" /* TRACE_STOPPED_BEFORE */] = 'Trace {$traceName} is not running.',\r\n    _a[\"no window\" /* NO_WINDOW */] = 'Window is not available.',\r\n    _a[\"no app id\" /* NO_APP_ID */] = 'App id is not available.',\r\n    _a[\"no project id\" /* NO_PROJECT_ID */] = 'Project id is not available.',\r\n    _a[\"no api key\" /* NO_API_KEY */] = 'Api key is not available.',\r\n    _a[\"invalid cc log\" /* INVALID_CC_LOG */] = 'Attempted to queue invalid cc event',\r\n    _a[\"FB not default\" /* FB_NOT_DEFAULT */] = 'Performance can only start when Firebase app instance is the default one.',\r\n    _a[\"RC response not ok\" /* RC_NOT_OK */] = 'RC response is not ok',\r\n    _a[\"invalid attribute name\" /* INVALID_ATTRIBUTE_NAME */] = 'Attribute name {$attributeName} is invalid.',\r\n    _a[\"invalid attribute value\" /* INVALID_ATTRIBUTE_VALUE */] = 'Attribute value {$attributeValue} is invalid.',\r\n    _a[\"invalide custom metric name\" /* INVALID_CUSTOM_METRIC_NAME */] = 'Custom metric name {$customMetricName} is invalid',\r\n    _a);\r\nvar ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar apiInstance;\r\nvar windowInstance;\r\n/**\r\n * This class holds a reference to various browser related objects injected by set methods.\r\n */\r\nvar Api = /** @class */ (function () {\r\n    function Api(window) {\r\n        if (!window) {\r\n            throw ERROR_FACTORY.create(\"no window\" /* NO_WINDOW */);\r\n        }\r\n        this.performance = window.performance;\r\n        this.PerformanceObserver = window.PerformanceObserver;\r\n        this.windowLocation = window.location;\r\n        this.navigator = window.navigator;\r\n        this.document = window.document;\r\n        if (this.navigator && this.navigator.cookieEnabled) {\r\n            // If user blocks cookies on the browser, accessing localStorage will throw an exception.\r\n            this.localStorage = window.localStorage;\r\n        }\r\n        if (window.perfMetrics && window.perfMetrics.onFirstInputDelay) {\r\n            this.onFirstInputDelay = window.perfMetrics.onFirstInputDelay;\r\n        }\r\n    }\r\n    Api.prototype.getUrl = function () {\r\n        // Do not capture the string query part of url.\r\n        return this.windowLocation.href.split('?')[0];\r\n    };\r\n    Api.prototype.mark = function (name) {\r\n        if (!this.performance || !this.performance.mark) {\r\n            return;\r\n        }\r\n        this.performance.mark(name);\r\n    };\r\n    Api.prototype.measure = function (measureName, mark1, mark2) {\r\n        if (!this.performance || !this.performance.measure) {\r\n            return;\r\n        }\r\n        this.performance.measure(measureName, mark1, mark2);\r\n    };\r\n    Api.prototype.getEntriesByType = function (type) {\r\n        if (!this.performance || !this.performance.getEntriesByType) {\r\n            return [];\r\n        }\r\n        return this.performance.getEntriesByType(type);\r\n    };\r\n    Api.prototype.getEntriesByName = function (name) {\r\n        if (!this.performance || !this.performance.getEntriesByName) {\r\n            return [];\r\n        }\r\n        return this.performance.getEntriesByName(name);\r\n    };\r\n    Api.prototype.getTimeOrigin = function () {\r\n        // Polyfill the time origin with performance.timing.navigationStart.\r\n        return (this.performance &&\r\n            (this.performance.timeOrigin || this.performance.timing.navigationStart));\r\n    };\r\n    Api.prototype.requiredApisAvailable = function () {\r\n        if (fetch && Promise && this.navigator && this.navigator.cookieEnabled) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    Api.prototype.setupObserver = function (entryType, callback) {\r\n        if (!this.PerformanceObserver) {\r\n            return;\r\n        }\r\n        var observer = new this.PerformanceObserver(function (list) {\r\n            for (var _i = 0, _a = list.getEntries(); _i < _a.length; _i++) {\r\n                var entry = _a[_i];\r\n                // `entry` is a PerformanceEntry instance.\r\n                callback(entry);\r\n            }\r\n        });\r\n        // Start observing the entry types you care about.\r\n        observer.observe({ entryTypes: [entryType] });\r\n    };\r\n    Api.getInstance = function () {\r\n        if (apiInstance === undefined) {\r\n            apiInstance = new Api(windowInstance);\r\n        }\r\n        return apiInstance;\r\n    };\r\n    return Api;\r\n}());\r\nfunction setupApi(window) {\r\n    windowInstance = window;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar settingsServiceInstance;\r\nvar SettingsService = /** @class */ (function () {\r\n    function SettingsService() {\r\n        // The variable which controls logging of automatic traces and HTTP/S network monitoring.\r\n        this.instrumentationEnabled = true;\r\n        // The variable which controls logging of custom traces.\r\n        this.dataCollectionEnabled = true;\r\n        // Configuration flags set through remote config.\r\n        this.loggingEnabled = false;\r\n        // Sampling rate between 0 and 1.\r\n        this.tracesSamplingRate = 1;\r\n        this.networkRequestsSamplingRate = 1;\r\n        // Address of logging service.\r\n        this.logEndPointUrl = 'https://firebaselogging.googleapis.com/v0cc/log?format=json_proto';\r\n        this.logSource = 462;\r\n        // Flags which control per session logging of traces and network requests.\r\n        this.logTraceAfterSampling = false;\r\n        this.logNetworkAfterSampling = false;\r\n        // TTL of config retrieved from remote config in hours.\r\n        this.configTimeToLive = 12;\r\n    }\r\n    SettingsService.prototype.getAppId = function () {\r\n        var appId = this.firebaseAppInstance &&\r\n            this.firebaseAppInstance.options &&\r\n            this.firebaseAppInstance.options.appId;\r\n        if (!appId) {\r\n            throw ERROR_FACTORY.create(\"no app id\" /* NO_APP_ID */);\r\n        }\r\n        return appId;\r\n    };\r\n    SettingsService.prototype.getProjectId = function () {\r\n        var projectId = this.firebaseAppInstance &&\r\n            this.firebaseAppInstance.options &&\r\n            this.firebaseAppInstance.options.projectId;\r\n        if (!projectId) {\r\n            throw ERROR_FACTORY.create(\"no project id\" /* NO_PROJECT_ID */);\r\n        }\r\n        return projectId;\r\n    };\r\n    SettingsService.prototype.getApiKey = function () {\r\n        var apiKey = this.firebaseAppInstance &&\r\n            this.firebaseAppInstance.options &&\r\n            this.firebaseAppInstance.options.apiKey;\r\n        if (!apiKey) {\r\n            throw ERROR_FACTORY.create(\"no api key\" /* NO_API_KEY */);\r\n        }\r\n        return apiKey;\r\n    };\r\n    SettingsService.getInstance = function () {\r\n        if (settingsServiceInstance === undefined) {\r\n            settingsServiceInstance = new SettingsService();\r\n        }\r\n        return settingsServiceInstance;\r\n    };\r\n    return SettingsService;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar iid;\r\nfunction getIidPromise() {\r\n    var iidPromise = SettingsService.getInstance()\r\n        .firebaseAppInstance.installations()\r\n        .getId();\r\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n    iidPromise.then(function (iidVal) {\r\n        iid = iidVal;\r\n    });\r\n    return iidPromise;\r\n}\r\n// This method should be used after the iid is retrieved by getIidPromise method.\r\nfunction getIid() {\r\n    return iid;\r\n}\r\nfunction getAuthTokenPromise() {\r\n    var authTokenPromise = SettingsService.getInstance()\r\n        .firebaseAppInstance.installations()\r\n        .getToken();\r\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n    authTokenPromise.then(function (authTokenVal) {\r\n    });\r\n    return authTokenPromise;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar VisibilityState;\r\n(function (VisibilityState) {\r\n    VisibilityState[VisibilityState[\"UNKNOWN\"] = 0] = \"UNKNOWN\";\r\n    VisibilityState[VisibilityState[\"VISIBLE\"] = 1] = \"VISIBLE\";\r\n    VisibilityState[VisibilityState[\"HIDDEN\"] = 2] = \"HIDDEN\";\r\n    VisibilityState[VisibilityState[\"PRERENDER\"] = 3] = \"PRERENDER\";\r\n    VisibilityState[VisibilityState[\"UNLOADED\"] = 4] = \"UNLOADED\";\r\n})(VisibilityState || (VisibilityState = {}));\r\nvar RESERVED_ATTRIBUTE_PREFIXES = ['firebase_', 'google_', 'ga_'];\r\nvar ATTRIBUTE_FORMAT_REGEX = new RegExp('^[a-zA-Z]\\\\w*$');\r\nvar MAX_ATTRIBUTE_NAME_LENGTH = 40;\r\nvar MAX_ATTRIBUTE_VALUE_LENGTH = 100;\r\nfunction getServiceWorkerStatus() {\r\n    var navigator = Api.getInstance().navigator;\r\n    if ('serviceWorker' in navigator) {\r\n        if (navigator.serviceWorker.controller) {\r\n            return 2 /* CONTROLLED */;\r\n        }\r\n        else {\r\n            return 3 /* UNCONTROLLED */;\r\n        }\r\n    }\r\n    else {\r\n        return 1 /* UNSUPPORTED */;\r\n    }\r\n}\r\nfunction getVisibilityState() {\r\n    var document = Api.getInstance().document;\r\n    var visibilityState = document.visibilityState;\r\n    switch (visibilityState) {\r\n        case 'visible':\r\n            return VisibilityState.VISIBLE;\r\n        case 'hidden':\r\n            return VisibilityState.HIDDEN;\r\n        case 'prerender':\r\n            return VisibilityState.PRERENDER;\r\n        default:\r\n            return VisibilityState.UNKNOWN;\r\n    }\r\n}\r\nfunction getEffectiveConnectionType() {\r\n    var navigator = Api.getInstance().navigator;\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    var navigatorConnection = navigator.connection;\r\n    var effectiveType = navigatorConnection && navigatorConnection.effectiveType;\r\n    switch (effectiveType) {\r\n        case 'slow-2g':\r\n            return 1 /* CONNECTION_SLOW_2G */;\r\n        case '2g':\r\n            return 2 /* CONNECTION_2G */;\r\n        case '3g':\r\n            return 3 /* CONNECTION_3G */;\r\n        case '4g':\r\n            return 4 /* CONNECTION_4G */;\r\n        default:\r\n            return 0 /* UNKNOWN */;\r\n    }\r\n}\r\nfunction isValidCustomAttributeName(name) {\r\n    if (name.length === 0 || name.length > MAX_ATTRIBUTE_NAME_LENGTH) {\r\n        return false;\r\n    }\r\n    var matchesReservedPrefix = RESERVED_ATTRIBUTE_PREFIXES.some(function (prefix) {\r\n        return name.startsWith(prefix);\r\n    });\r\n    return !matchesReservedPrefix && !!name.match(ATTRIBUTE_FORMAT_REGEX);\r\n}\r\nfunction isValidCustomAttributeValue(value) {\r\n    return value.length !== 0 && value.length <= MAX_ATTRIBUTE_VALUE_LENGTH;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar consoleLogger = new Logger(SERVICE_NAME);\r\nconsoleLogger.logLevel = LogLevel.INFO;\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar REMOTE_CONFIG_SDK_VERSION = '0.0.1';\r\n// These values will be used if the remote config object is successfully\r\n// retrieved, but the template does not have these fields.\r\nvar SECONDARY_CONFIGS = {\r\n    loggingEnabled: true\r\n};\r\nvar FIS_AUTH_PREFIX = 'FIREBASE_INSTALLATIONS_AUTH';\r\nfunction getConfig(iid) {\r\n    var config = getStoredConfig();\r\n    if (config) {\r\n        processConfig(config);\r\n        return Promise.resolve();\r\n    }\r\n    return getRemoteConfig(iid)\r\n        .then(function (config) { return processConfig(config); })\r\n        .then(function (config) { return storeConfig(config); }, \r\n    /** Do nothing for error, use defaults set in settings service. */ function () { });\r\n}\r\nfunction getStoredConfig() {\r\n    var localStorage = Api.getInstance().localStorage;\r\n    var expiryString = localStorage.getItem(CONFIG_EXPIRY_LOCAL_STORAGE_KEY);\r\n    if (!expiryString || !configValid(expiryString)) {\r\n        return;\r\n    }\r\n    var configStringified = localStorage.getItem(CONFIG_LOCAL_STORAGE_KEY);\r\n    if (!configStringified) {\r\n        return;\r\n    }\r\n    try {\r\n        var configResponse = JSON.parse(configStringified);\r\n        return configResponse;\r\n    }\r\n    catch (_a) {\r\n        return;\r\n    }\r\n}\r\nfunction storeConfig(config) {\r\n    if (!config) {\r\n        return;\r\n    }\r\n    var localStorage = Api.getInstance().localStorage;\r\n    localStorage.setItem(CONFIG_LOCAL_STORAGE_KEY, JSON.stringify(config));\r\n    localStorage.setItem(CONFIG_EXPIRY_LOCAL_STORAGE_KEY, String(Date.now() +\r\n        SettingsService.getInstance().configTimeToLive * 60 * 60 * 1000));\r\n}\r\nvar COULD_NOT_GET_CONFIG_MSG = 'Could not fetch config, will use default configs';\r\nfunction getRemoteConfig(iid) {\r\n    // Perf needs auth token only to retrieve remote config.\r\n    return getAuthTokenPromise()\r\n        .then(function (authToken) {\r\n        var projectId = SettingsService.getInstance().getProjectId();\r\n        var configEndPoint = \"https://firebaseremoteconfig.googleapis.com/v1/projects/\" + projectId + \"/namespaces/fireperf:fetch?key=\" + SettingsService.getInstance().getApiKey();\r\n        var request = new Request(configEndPoint, {\r\n            method: 'POST',\r\n            headers: {\r\n                Authorization: FIS_AUTH_PREFIX + \" \" + authToken\r\n            },\r\n            /* eslint-disable camelcase */\r\n            body: JSON.stringify({\r\n                app_instance_id: iid,\r\n                app_instance_id_token: authToken,\r\n                app_id: SettingsService.getInstance().getAppId(),\r\n                app_version: SDK_VERSION,\r\n                sdk_version: REMOTE_CONFIG_SDK_VERSION\r\n            })\r\n            /* eslint-enable camelcase */\r\n        });\r\n        return fetch(request).then(function (response) {\r\n            if (response.ok) {\r\n                return response.json();\r\n            }\r\n            // In case response is not ok. This will be caught by catch.\r\n            throw ERROR_FACTORY.create(\"RC response not ok\" /* RC_NOT_OK */);\r\n        });\r\n    })\r\n        .catch(function () {\r\n        consoleLogger.info(COULD_NOT_GET_CONFIG_MSG);\r\n        return undefined;\r\n    });\r\n}\r\n/**\r\n * Processes config coming either from calling RC or from local storage.\r\n * This method only runs if call is successful or config in storage\r\n * is valie.\r\n */\r\nfunction processConfig(config) {\r\n    if (!config) {\r\n        return config;\r\n    }\r\n    var settingsServiceInstance = SettingsService.getInstance();\r\n    var entries = config.entries || {};\r\n    if (entries.fpr_enabled !== undefined) {\r\n        // TODO: Change the assignment of loggingEnabled once the received type is known.\r\n        settingsServiceInstance.loggingEnabled =\r\n            String(entries.fpr_enabled) === 'true';\r\n    }\r\n    else {\r\n        // Config retrieved successfully, but there is no fpr_enabled in template.\r\n        // Use secondary configs value.\r\n        settingsServiceInstance.loggingEnabled = SECONDARY_CONFIGS.loggingEnabled;\r\n    }\r\n    if (entries.fpr_log_source) {\r\n        settingsServiceInstance.logSource = Number(entries.fpr_log_source);\r\n    }\r\n    if (entries.fpr_log_endpoint_url) {\r\n        settingsServiceInstance.logEndPointUrl = entries.fpr_log_endpoint_url;\r\n    }\r\n    if (entries.fpr_vc_network_request_sampling_rate !== undefined) {\r\n        settingsServiceInstance.networkRequestsSamplingRate = Number(entries.fpr_vc_network_request_sampling_rate);\r\n    }\r\n    if (entries.fpr_vc_trace_sampling_rate !== undefined) {\r\n        settingsServiceInstance.tracesSamplingRate = Number(entries.fpr_vc_trace_sampling_rate);\r\n    }\r\n    // Set the per session trace and network logging flags.\r\n    settingsServiceInstance.logTraceAfterSampling = shouldLogAfterSampling(settingsServiceInstance.tracesSamplingRate);\r\n    settingsServiceInstance.logNetworkAfterSampling = shouldLogAfterSampling(settingsServiceInstance.networkRequestsSamplingRate);\r\n    return config;\r\n}\r\nfunction configValid(expiry) {\r\n    return Number(expiry) > Date.now();\r\n}\r\nfunction shouldLogAfterSampling(samplingRate) {\r\n    return Math.random() <= samplingRate;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar initializationStatus = 1 /* notInitialized */;\r\nvar initializationPromise;\r\nfunction getInitializationPromise() {\r\n    initializationStatus = 2 /* initializationPending */;\r\n    initializationPromise = initializationPromise || initializePerf();\r\n    return initializationPromise;\r\n}\r\nfunction isPerfInitialized() {\r\n    return initializationStatus === 3 /* initialized */;\r\n}\r\nfunction initializePerf() {\r\n    return getDocumentReadyComplete()\r\n        .then(function () { return getIidPromise(); })\r\n        .then(function (iid) { return getConfig(iid); })\r\n        .then(function () { return changeInitializationStatus(); }, function () { return changeInitializationStatus(); });\r\n}\r\n/**\r\n * Returns a promise which resolves whenever the document readystate is complete or\r\n * immediately if it is called after page load complete.\r\n */\r\nfunction getDocumentReadyComplete() {\r\n    var document = Api.getInstance().document;\r\n    return new Promise(function (resolve) {\r\n        if (document && document.readyState !== 'complete') {\r\n            var handler_1 = function () {\r\n                if (document.readyState === 'complete') {\r\n                    document.removeEventListener('readystatechange', handler_1);\r\n                    resolve();\r\n                }\r\n            };\r\n            document.addEventListener('readystatechange', handler_1);\r\n        }\r\n        else {\r\n            resolve();\r\n        }\r\n    });\r\n}\r\nfunction changeInitializationStatus() {\r\n    initializationStatus = 3 /* initialized */;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DEFAULT_SEND_INTERVAL_MS = 10 * 1000;\r\nvar INITIAL_SEND_TIME_DELAY_MS = 5.5 * 1000;\r\n// If end point does not work, the call will be tried for these many times.\r\nvar DEFAULT_REMAINING_TRIES = 3;\r\nvar remainingTries = DEFAULT_REMAINING_TRIES;\r\n/* eslint-enable camelcase */\r\nvar queue = [];\r\nfunction processQueue(timeOffset) {\r\n    setTimeout(function () {\r\n        // If there is no remainingTries left, stop retrying.\r\n        if (remainingTries === 0) {\r\n            return;\r\n        }\r\n        // If there are no events to process, wait for DEFAULT_SEND_INTERVAL_MS and try again.\r\n        if (!queue.length) {\r\n            return processQueue(DEFAULT_SEND_INTERVAL_MS);\r\n        }\r\n        // Capture a snapshot of the queue and empty the \"official queue\".\r\n        var staged = queue.slice();\r\n        queue = [];\r\n        /* eslint-disable camelcase */\r\n        // We will pass the JSON serialized event to the backend.\r\n        var log_event = staged.map(function (evt) { return ({\r\n            source_extension_json: evt.message,\r\n            event_time_ms: String(evt.eventTime)\r\n        }); });\r\n        var data = {\r\n            request_time_ms: String(Date.now()),\r\n            client_info: {\r\n                client_type: 1,\r\n                js_client_info: {}\r\n            },\r\n            log_source: SettingsService.getInstance().logSource,\r\n            log_event: log_event\r\n        };\r\n        /* eslint-enable camelcase */\r\n        fetch(SettingsService.getInstance().logEndPointUrl, {\r\n            method: 'POST',\r\n            body: JSON.stringify(data)\r\n        })\r\n            .then(function (res) {\r\n            if (!res.ok) {\r\n                consoleLogger.info('Call to Firebase backend failed.');\r\n            }\r\n            return res.json();\r\n        })\r\n            .then(function (res) {\r\n            var wait = Number(res.next_request_wait_millis);\r\n            // Find the next call wait time from the response.\r\n            var requestOffset = isNaN(wait)\r\n                ? DEFAULT_SEND_INTERVAL_MS\r\n                : Math.max(DEFAULT_SEND_INTERVAL_MS, wait);\r\n            remainingTries = DEFAULT_REMAINING_TRIES;\r\n            // Schedule the next process.\r\n            processQueue(requestOffset);\r\n        })\r\n            .catch(function () {\r\n            /**\r\n             * If the request fails for some reason, add the events that were attempted\r\n             * back to the primary queue to retry later.\r\n             */\r\n            queue = staged.concat(queue);\r\n            remainingTries--;\r\n            consoleLogger.info(\"Tries left: \" + remainingTries + \".\");\r\n            processQueue(DEFAULT_SEND_INTERVAL_MS);\r\n        });\r\n    }, timeOffset);\r\n}\r\nprocessQueue(INITIAL_SEND_TIME_DELAY_MS);\r\nfunction addToQueue(evt) {\r\n    if (!evt.eventTime || !evt.message) {\r\n        throw ERROR_FACTORY.create(\"invalid cc log\" /* INVALID_CC_LOG */);\r\n    }\r\n    // Add the new event to the queue.\r\n    queue = queue.concat([evt]);\r\n}\r\n/** Log handler for cc service to send the performance logs to the server. */\r\nfunction ccHandler(\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nserializer) {\r\n    // The underscores for loggerInstance and level parameters are added to avoid the\r\n    // noUnusedParameters related error.\r\n    return function (_loggerInstance, _level) {\r\n        var args = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            args[_i - 2] = arguments[_i];\r\n        }\r\n        var message = serializer.apply(void 0, args);\r\n        addToQueue({\r\n            message: message,\r\n            eventTime: Date.now()\r\n        });\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/* eslint-enble camelcase */\r\nvar logger;\r\n// This method is not called before initialization.\r\nfunction getLogger() {\r\n    if (logger) {\r\n        return logger;\r\n    }\r\n    var ccLogger = ccHandler(serializer);\r\n    logger = new Logger('@firebase/performance/cc');\r\n    logger.logHandler = ccLogger;\r\n    return logger;\r\n}\r\nfunction logTrace(trace) {\r\n    var settingsService = SettingsService.getInstance();\r\n    // Do not log if trace is auto generated and instrumentation is disabled.\r\n    if (!settingsService.instrumentationEnabled && trace.isAuto) {\r\n        return;\r\n    }\r\n    // Do not log if trace is custom and data collection is disabled.\r\n    if (!settingsService.dataCollectionEnabled && !trace.isAuto) {\r\n        return;\r\n    }\r\n    // Do not log if required apis are not available.\r\n    if (!Api.getInstance().requiredApisAvailable()) {\r\n        return;\r\n    }\r\n    // Only log the page load auto traces if page is visible.\r\n    if (trace.isAuto && getVisibilityState() !== VisibilityState.VISIBLE) {\r\n        return;\r\n    }\r\n    if (!settingsService.loggingEnabled ||\r\n        !settingsService.logTraceAfterSampling) {\r\n        return;\r\n    }\r\n    if (isPerfInitialized()) {\r\n        sendTraceLog(trace);\r\n    }\r\n    else {\r\n        // Custom traces can be used before the initialization but logging\r\n        // should wait until after.\r\n        getInitializationPromise().then(function () { return sendTraceLog(trace); }, function () { return sendTraceLog(trace); });\r\n    }\r\n}\r\nfunction sendTraceLog(trace) {\r\n    if (getIid()) {\r\n        setTimeout(function () { return getLogger().log(trace, 1 /* Trace */); }, 0);\r\n    }\r\n}\r\nfunction logNetworkRequest(networkRequest) {\r\n    var settingsService = SettingsService.getInstance();\r\n    // Do not log network requests if instrumentation is disabled.\r\n    if (!settingsService.instrumentationEnabled) {\r\n        return;\r\n    }\r\n    // Do not log the js sdk's call to cc service to avoid unnecessary cycle.\r\n    if (networkRequest.url === settingsService.logEndPointUrl.split('?')[0]) {\r\n        return;\r\n    }\r\n    if (!settingsService.loggingEnabled ||\r\n        !settingsService.logNetworkAfterSampling) {\r\n        return;\r\n    }\r\n    setTimeout(function () { return getLogger().log(networkRequest, 0 /* NetworkRequest */); }, 0);\r\n}\r\nfunction serializer(resource, resourceType) {\r\n    if (resourceType === 0 /* NetworkRequest */) {\r\n        return serializeNetworkRequest(resource);\r\n    }\r\n    return serializeTrace(resource);\r\n}\r\nfunction serializeNetworkRequest(networkRequest) {\r\n    var networkRequestMetric = {\r\n        url: networkRequest.url,\r\n        http_method: networkRequest.httpMethod || 0,\r\n        http_response_code: 200,\r\n        response_payload_bytes: networkRequest.responsePayloadBytes,\r\n        client_start_time_us: networkRequest.startTimeUs,\r\n        time_to_response_initiated_us: networkRequest.timeToResponseInitiatedUs,\r\n        time_to_response_completed_us: networkRequest.timeToResponseCompletedUs\r\n    };\r\n    var perfMetric = {\r\n        application_info: getApplicationInfo(),\r\n        network_request_metric: networkRequestMetric\r\n    };\r\n    return JSON.stringify(perfMetric);\r\n}\r\nfunction serializeTrace(trace) {\r\n    var traceMetric = {\r\n        name: trace.name,\r\n        is_auto: trace.isAuto,\r\n        client_start_time_us: trace.startTimeUs,\r\n        duration_us: trace.durationUs\r\n    };\r\n    if (Object.keys(trace.counters).length !== 0) {\r\n        traceMetric.counters = convertToKeyValueArray(trace.counters);\r\n    }\r\n    var customAttributes = trace.getAttributes();\r\n    if (Object.keys(customAttributes).length !== 0) {\r\n        traceMetric.custom_attributes = convertToKeyValueArray(customAttributes);\r\n    }\r\n    var perfMetric = {\r\n        application_info: getApplicationInfo(),\r\n        trace_metric: traceMetric\r\n    };\r\n    return JSON.stringify(perfMetric);\r\n}\r\nfunction getApplicationInfo() {\r\n    return {\r\n        google_app_id: SettingsService.getInstance().getAppId(),\r\n        app_instance_id: getIid(),\r\n        web_app_info: {\r\n            sdk_version: SDK_VERSION,\r\n            page_url: Api.getInstance().getUrl(),\r\n            service_worker_status: getServiceWorkerStatus(),\r\n            visibility_state: getVisibilityState(),\r\n            effective_connection_type: getEffectiveConnectionType()\r\n        },\r\n        application_process_state: 0\r\n    };\r\n}\r\nfunction convertToKeyValueArray(obj) {\r\n    var keys = Object.keys(obj);\r\n    return keys.map(function (key) { return ({ key: key, value: obj[key] }); });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar MAX_METRIC_NAME_LENGTH = 100;\r\nvar RESERVED_AUTO_PREFIX = '_';\r\nvar oobMetrics = [\r\n    FIRST_PAINT_COUNTER_NAME,\r\n    FIRST_CONTENTFUL_PAINT_COUNTER_NAME,\r\n    FIRST_INPUT_DELAY_COUNTER_NAME\r\n];\r\n/**\r\n * Returns true if the metric is custom and does not start with reserved prefix, or if\r\n * the metric is one of out of the box page load trace metrics.\r\n */\r\nfunction isValidMetricName(name, traceName) {\r\n    if (name.length === 0 || name.length > MAX_METRIC_NAME_LENGTH) {\r\n        return false;\r\n    }\r\n    return ((traceName &&\r\n        traceName.startsWith(OOB_TRACE_PAGE_LOAD_PREFIX) &&\r\n        oobMetrics.indexOf(name) > -1) ||\r\n        !name.startsWith(RESERVED_AUTO_PREFIX));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar Trace = /** @class */ (function () {\r\n    /**\r\n     * @param name The name of the trace.\r\n     * @param isAuto If the trace is auto-instrumented.\r\n     * @param traceMeasureName The name of the measure marker in user timing specification. This field\r\n     * is only set when the trace is built for logging when the user directly uses the user timing\r\n     * api (performance.mark and performance.measure).\r\n     */\r\n    function Trace(name, isAuto, traceMeasureName) {\r\n        if (isAuto === void 0) { isAuto = false; }\r\n        this.name = name;\r\n        this.isAuto = isAuto;\r\n        this.state = 1 /* UNINITIALIZED */;\r\n        this.customAttributes = {};\r\n        this.counters = {};\r\n        this.api = Api.getInstance();\r\n        this.randomId = Math.floor(Math.random() * 1000000);\r\n        if (!this.isAuto) {\r\n            this.traceStartMark = TRACE_START_MARK_PREFIX + \"-\" + this.randomId + \"-\" + this.name;\r\n            this.traceStopMark = TRACE_STOP_MARK_PREFIX + \"-\" + this.randomId + \"-\" + this.name;\r\n            this.traceMeasure =\r\n                traceMeasureName ||\r\n                    TRACE_MEASURE_PREFIX + \"-\" + this.randomId + \"-\" + this.name;\r\n            if (traceMeasureName) {\r\n                // For the case of direct user timing traces, no start stop will happen. The measure object\r\n                // is already available.\r\n                this.calculateTraceMetrics();\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Starts a trace. The measurement of the duration starts at this point.\r\n     */\r\n    Trace.prototype.start = function () {\r\n        if (this.state !== 1 /* UNINITIALIZED */) {\r\n            throw ERROR_FACTORY.create(\"trace started\" /* TRACE_STARTED_BEFORE */, {\r\n                traceName: this.name\r\n            });\r\n        }\r\n        this.api.mark(this.traceStartMark);\r\n        this.state = 2 /* RUNNING */;\r\n    };\r\n    /**\r\n     * Stops the trace. The measurement of the duration of the trace stops at this point and trace\r\n     * is logged.\r\n     */\r\n    Trace.prototype.stop = function () {\r\n        if (this.state !== 2 /* RUNNING */) {\r\n            throw ERROR_FACTORY.create(\"trace stopped\" /* TRACE_STOPPED_BEFORE */, {\r\n                traceName: this.name\r\n            });\r\n        }\r\n        this.state = 3 /* TERMINATED */;\r\n        this.api.mark(this.traceStopMark);\r\n        this.api.measure(this.traceMeasure, this.traceStartMark, this.traceStopMark);\r\n        this.calculateTraceMetrics();\r\n        logTrace(this);\r\n    };\r\n    /**\r\n     * Records a trace with predetermined values. If this method is used a trace is created and logged\r\n     * directly. No need to use start and stop methods.\r\n     * @param startTime Trace start time since epoch in millisec\r\n     * @param duration The duraction of the trace in millisec\r\n     * @param options An object which can optionally hold maps of custom metrics and custom attributes\r\n     */\r\n    Trace.prototype.record = function (startTime, duration, options) {\r\n        this.durationUs = Math.floor(duration * 1000);\r\n        this.startTimeUs = Math.floor(startTime * 1000);\r\n        if (options && options.attributes) {\r\n            this.customAttributes = __assign({}, options.attributes);\r\n        }\r\n        if (options && options.metrics) {\r\n            for (var _i = 0, _a = Object.keys(options.metrics); _i < _a.length; _i++) {\r\n                var metric = _a[_i];\r\n                if (!isNaN(Number(options.metrics[metric]))) {\r\n                    this.counters[metric] = Number(Math.floor(options.metrics[metric]));\r\n                }\r\n            }\r\n        }\r\n        logTrace(this);\r\n    };\r\n    /**\r\n     * Increments a custom metric by a certain number or 1 if number not specified. Will create a new\r\n     * custom metric if one with the given name does not exist.\r\n     * @param counter Name of the custom metric\r\n     * @param num Increment by value\r\n     */\r\n    Trace.prototype.incrementMetric = function (counter, num) {\r\n        if (num === void 0) { num = 1; }\r\n        if (this.counters[counter] === undefined) {\r\n            this.putMetric(counter, 0);\r\n        }\r\n        this.counters[counter] += num;\r\n    };\r\n    /**\r\n     * Sets a custom metric to a specified value. Will create a new custom metric if one with the\r\n     * given name does not exist.\r\n     * @param counter Name of the custom metric\r\n     * @param num Set custom metric to this value\r\n     */\r\n    Trace.prototype.putMetric = function (counter, num) {\r\n        if (isValidMetricName(counter, this.name)) {\r\n            this.counters[counter] = num;\r\n        }\r\n        else {\r\n            throw ERROR_FACTORY.create(\"invalide custom metric name\" /* INVALID_CUSTOM_METRIC_NAME */, {\r\n                customMetricName: counter\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * Returns the value of the custom metric by that name. If a custom metric with that name does\r\n     * not exist will return zero.\r\n     * @param counter\r\n     */\r\n    Trace.prototype.getMetric = function (counter) {\r\n        return this.counters[counter] || 0;\r\n    };\r\n    /**\r\n     * Sets a custom attribute of a trace to a certain value.\r\n     * @param attr\r\n     * @param value\r\n     */\r\n    Trace.prototype.putAttribute = function (attr, value) {\r\n        var isValidName = isValidCustomAttributeName(attr);\r\n        var isValidValue = isValidCustomAttributeValue(value);\r\n        if (isValidName && isValidValue) {\r\n            this.customAttributes[attr] = value;\r\n            return;\r\n        }\r\n        // Throw appropriate error when the attribute name or value is invalid.\r\n        if (!isValidName) {\r\n            throw ERROR_FACTORY.create(\"invalid attribute name\" /* INVALID_ATTRIBUTE_NAME */, {\r\n                attributeName: attr\r\n            });\r\n        }\r\n        if (!isValidValue) {\r\n            throw ERROR_FACTORY.create(\"invalid attribute value\" /* INVALID_ATTRIBUTE_VALUE */, {\r\n                attributeValue: value\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * Retrieves the value a custom attribute of a trace is set to.\r\n     * @param attr\r\n     */\r\n    Trace.prototype.getAttribute = function (attr) {\r\n        return this.customAttributes[attr];\r\n    };\r\n    Trace.prototype.removeAttribute = function (attr) {\r\n        if (this.customAttributes[attr] === undefined) {\r\n            return;\r\n        }\r\n        delete this.customAttributes[attr];\r\n    };\r\n    Trace.prototype.getAttributes = function () {\r\n        return __assign({}, this.customAttributes);\r\n    };\r\n    Trace.prototype.setStartTime = function (startTime) {\r\n        this.startTimeUs = startTime;\r\n    };\r\n    Trace.prototype.setDuration = function (duration) {\r\n        this.durationUs = duration;\r\n    };\r\n    /**\r\n     * Calculates and assigns the duration and start time of the trace using the measure performance\r\n     * entry.\r\n     */\r\n    Trace.prototype.calculateTraceMetrics = function () {\r\n        var perfMeasureEntries = this.api.getEntriesByName(this.traceMeasure);\r\n        var perfMeasureEntry = perfMeasureEntries && perfMeasureEntries[0];\r\n        if (perfMeasureEntry) {\r\n            this.durationUs = Math.floor(perfMeasureEntry.duration * 1000);\r\n            this.startTimeUs = Math.floor((perfMeasureEntry.startTime + this.api.getTimeOrigin()) * 1000);\r\n        }\r\n    };\r\n    /**\r\n     * @param navigationTimings A single element array which contains the navigationTIming object of\r\n     * the page load\r\n     * @param paintTimings A array which contains paintTiming object of the page load\r\n     * @param firstInputDelay First input delay in millisec\r\n     */\r\n    Trace.createOobTrace = function (navigationTimings, paintTimings, firstInputDelay) {\r\n        var route = Api.getInstance().getUrl();\r\n        if (!route) {\r\n            return;\r\n        }\r\n        var trace = new Trace(OOB_TRACE_PAGE_LOAD_PREFIX + route, true);\r\n        var timeOriginUs = Math.floor(Api.getInstance().getTimeOrigin() * 1000);\r\n        trace.setStartTime(timeOriginUs);\r\n        // navigationTimings includes only one element.\r\n        if (navigationTimings && navigationTimings[0]) {\r\n            trace.setDuration(Math.floor(navigationTimings[0].duration * 1000));\r\n            trace.putMetric('domInteractive', Math.floor(navigationTimings[0].domInteractive * 1000));\r\n            trace.putMetric('domContentLoadedEventEnd', Math.floor(navigationTimings[0].domContentLoadedEventEnd * 1000));\r\n            trace.putMetric('loadEventEnd', Math.floor(navigationTimings[0].loadEventEnd * 1000));\r\n        }\r\n        var FIRST_PAINT = 'first-paint';\r\n        var FIRST_CONTENTFUL_PAINT = 'first-contentful-paint';\r\n        if (paintTimings) {\r\n            var firstPaint = paintTimings.find(function (paintObject) { return paintObject.name === FIRST_PAINT; });\r\n            if (firstPaint && firstPaint.startTime) {\r\n                trace.putMetric(FIRST_PAINT_COUNTER_NAME, Math.floor(firstPaint.startTime * 1000));\r\n            }\r\n            var firstContentfulPaint = paintTimings.find(function (paintObject) { return paintObject.name === FIRST_CONTENTFUL_PAINT; });\r\n            if (firstContentfulPaint && firstContentfulPaint.startTime) {\r\n                trace.putMetric(FIRST_CONTENTFUL_PAINT_COUNTER_NAME, Math.floor(firstContentfulPaint.startTime * 1000));\r\n            }\r\n            if (firstInputDelay) {\r\n                trace.putMetric(FIRST_INPUT_DELAY_COUNTER_NAME, Math.floor(firstInputDelay * 1000));\r\n            }\r\n        }\r\n        logTrace(trace);\r\n    };\r\n    Trace.createUserTimingTrace = function (measureName) {\r\n        var trace = new Trace(measureName, false, measureName);\r\n        logTrace(trace);\r\n    };\r\n    return Trace;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction createNetworkRequestEntry(entry) {\r\n    var performanceEntry = entry;\r\n    if (!performanceEntry || performanceEntry.responseStart === undefined) {\r\n        return;\r\n    }\r\n    var timeOrigin = Api.getInstance().getTimeOrigin();\r\n    var startTimeUs = Math.floor((performanceEntry.startTime + timeOrigin) * 1000);\r\n    var timeToResponseInitiatedUs = performanceEntry.responseStart\r\n        ? Math.floor((performanceEntry.responseStart - performanceEntry.startTime) * 1000)\r\n        : undefined;\r\n    var timeToResponseCompletedUs = Math.floor((performanceEntry.responseEnd - performanceEntry.startTime) * 1000);\r\n    // Remove the query params from logged network request url.\r\n    var url = performanceEntry.name && performanceEntry.name.split('?')[0];\r\n    var networkRequest = {\r\n        url: url,\r\n        responsePayloadBytes: performanceEntry.transferSize,\r\n        startTimeUs: startTimeUs,\r\n        timeToResponseInitiatedUs: timeToResponseInitiatedUs,\r\n        timeToResponseCompletedUs: timeToResponseCompletedUs\r\n    };\r\n    logNetworkRequest(networkRequest);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar FID_WAIT_TIME_MS = 5000;\r\nfunction setupOobResources() {\r\n    // Do not initialize unless iid is available.\r\n    if (!getIid()) {\r\n        return;\r\n    }\r\n    // The load event might not have fired yet, and that means performance navigation timing\r\n    // object has a duration of 0. The setup should run after all current tasks in js queue.\r\n    setTimeout(function () { return setupOobTraces(); }, 0);\r\n    setTimeout(function () { return setupNetworkRequests(); }, 0);\r\n    setTimeout(function () { return setupUserTimingTraces(); }, 0);\r\n}\r\nfunction setupNetworkRequests() {\r\n    var api = Api.getInstance();\r\n    var resources = api.getEntriesByType('resource');\r\n    for (var _i = 0, resources_1 = resources; _i < resources_1.length; _i++) {\r\n        var resource = resources_1[_i];\r\n        createNetworkRequestEntry(resource);\r\n    }\r\n    api.setupObserver('resource', createNetworkRequestEntry);\r\n}\r\nfunction setupOobTraces() {\r\n    var api = Api.getInstance();\r\n    var navigationTimings = api.getEntriesByType('navigation');\r\n    var paintTimings = api.getEntriesByType('paint');\r\n    // If First Input Desly polyfill is added to the page, report the fid value.\r\n    // https://github.com/GoogleChromeLabs/first-input-delay\r\n    if (api.onFirstInputDelay) {\r\n        // If the fid call back is not called for certain time, continue without it.\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        var timeoutId_1 = setTimeout(function () {\r\n            Trace.createOobTrace(navigationTimings, paintTimings);\r\n            timeoutId_1 = undefined;\r\n        }, FID_WAIT_TIME_MS);\r\n        api.onFirstInputDelay(function (fid) {\r\n            if (timeoutId_1) {\r\n                clearTimeout(timeoutId_1);\r\n                Trace.createOobTrace(navigationTimings, paintTimings, fid);\r\n            }\r\n        });\r\n    }\r\n    else {\r\n        Trace.createOobTrace(navigationTimings, paintTimings);\r\n    }\r\n}\r\nfunction setupUserTimingTraces() {\r\n    var api = Api.getInstance();\r\n    // Run through the measure performance entries collected up to this point.\r\n    var measures = api.getEntriesByType('measure');\r\n    for (var _i = 0, measures_1 = measures; _i < measures_1.length; _i++) {\r\n        var measure = measures_1[_i];\r\n        createUserTimingTrace(measure);\r\n    }\r\n    // Setup an observer to capture the measures from this point on.\r\n    api.setupObserver('measure', createUserTimingTrace);\r\n}\r\nfunction createUserTimingTrace(measure) {\r\n    var measureName = measure.name;\r\n    // Do not create a trace, if the user timing marks and measures are created by the sdk itself.\r\n    if (measureName.substring(0, TRACE_MEASURE_PREFIX.length) ===\r\n        TRACE_MEASURE_PREFIX) {\r\n        return;\r\n    }\r\n    Trace.createUserTimingTrace(measureName);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar PerformanceController = /** @class */ (function () {\r\n    function PerformanceController(app) {\r\n        this.app = app;\r\n        if (Api.getInstance().requiredApisAvailable()) {\r\n            getInitializationPromise().then(setupOobResources, setupOobResources);\r\n        }\r\n        else {\r\n            consoleLogger.info('Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.');\r\n        }\r\n    }\r\n    PerformanceController.prototype.trace = function (name) {\r\n        return new Trace(name);\r\n    };\r\n    Object.defineProperty(PerformanceController.prototype, \"instrumentationEnabled\", {\r\n        get: function () {\r\n            return SettingsService.getInstance().instrumentationEnabled;\r\n        },\r\n        set: function (val) {\r\n            SettingsService.getInstance().instrumentationEnabled = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(PerformanceController.prototype, \"dataCollectionEnabled\", {\r\n        get: function () {\r\n            return SettingsService.getInstance().dataCollectionEnabled;\r\n        },\r\n        set: function (val) {\r\n            SettingsService.getInstance().dataCollectionEnabled = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return PerformanceController;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DEFAULT_ENTRY_NAME = '[DEFAULT]';\r\nfunction registerPerformance(instance) {\r\n    var factoryMethod = function (app) {\r\n        if (app.name !== DEFAULT_ENTRY_NAME) {\r\n            throw ERROR_FACTORY.create(\"FB not default\" /* FB_NOT_DEFAULT */);\r\n        }\r\n        if (typeof window === 'undefined') {\r\n            throw ERROR_FACTORY.create(\"no window\" /* NO_WINDOW */);\r\n        }\r\n        setupApi(window);\r\n        SettingsService.getInstance().firebaseAppInstance = app;\r\n        return new PerformanceController(app);\r\n    };\r\n    // Register performance with firebase-app.\r\n    var namespaceExports = {};\r\n    instance.INTERNAL.registerService('performance', factoryMethod, namespaceExports);\r\n}\r\nregisterPerformance(firebase);\n\nexport { registerPerformance };\n//# sourceMappingURL=index.esm.js.map\n\n\n\n// WEBPACK FOOTER //\n// ../node_modules/@firebase/performance/dist/index.esm.js","import '@firebase/performance';\n//# sourceMappingURL=index.esm.js.map\n\n\n\n// WEBPACK FOOTER //\n// ../node_modules/firebase/performance/dist/index.esm.js"],"sourceRoot":""}